<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:scanner="clr-namespace:BarcodeScanning;assembly=BarcodeScanning.Native.Maui"
    x:Class="SayApp.FichajesQR.LectorAndroid.MainPage"
    Title="Lector QR"
    BackgroundColor="#121212"
    NavigationPage.HasNavigationBar="False">

    <Grid
        ColumnDefinitions="380,*"
        RowDefinitions="Auto,*"
        Padding="0"
        Margin="0"
        BackgroundColor="#121212">

        <!-- Panel izquierdo -->
        <VerticalStackLayout
            Padding="20"
            Spacing="16"
            BackgroundColor="#1E1E1E"
            Grid.RowSpan="2"
            VerticalOptions="Fill"
            HorizontalOptions="Fill">

            <Label Text="Control de acceso"
                   FontAttributes="Bold"
                   FontSize="20"
                   TextColor="White" />

            <Button x:Name="BtnStart"
                    Text="Iniciar cámara"
                    Clicked="BtnStart_Clicked"
                    BackgroundColor="#249429"
                    TextColor="White" />

            <Button x:Name="BtnStop"
                    Text="Detener cámara"
                    Clicked="BtnStop_Clicked"
                    BackgroundColor="#C94929"
                    TextColor="White" />

            <Button x:Name="BtnToggleCam"
                    Text="Cambiar cámara"
                    Clicked="BtnToggleCam_Clicked"
                    BackgroundColor="#C9A72B"
                    TextColor="White"
                    IsVisible="True" />

            <BoxView HeightRequest="1" Color="#333333" Margin="0,10" />

            <Label x:Name="LblEstado"
                   Text="Estado: Inactivo"
                   FontSize="14"
                   TextColor="White" />

            <Label x:Name="LblUltimo"
                   Text="Último QR leído: -"
                   FontSize="13"
                   TextColor="#CCCCCC" />

            <Label Text="Instrucciones"
                   FontAttributes="Bold"
                   FontSize="15"
                   TextColor="White" />

            <Label Text="1) Sitúe su QR dentro del recuadro a la derecha."
                   FontSize="13"
                   TextColor="#CCCCCC" />

            <Label Text="2) Acerque o aleje hasta que el borde se ponga verde."
                   FontSize="13"
                   TextColor="#CCCCCC" />
        </VerticalStackLayout>

        <!-- Panel derecho (vista de cámara) -->
        <Grid Grid.Column="1"
              Grid.Row="1"
              VerticalOptions="Fill"
              HorizontalOptions="Fill"
              Padding="0"
              Margin="0">

            <AbsoluteLayout HorizontalOptions="Fill"
                            VerticalOptions="Fill">

                <!-- Cámara -->
                <scanner:CameraView x:Name="Camera"
                                    CameraEnabled="False"
                                    CameraFacing="Back"
                                    TapToFocusEnabled="True"
                                    VibrationOnDetected="True"
                                    CaptureQuality="High"
                                    BarcodeSymbologies="QRCode"
                                    OnDetectionFinished="Camera_OnDetectionFinished"
                                    BackgroundColor="Black"
                                    AbsoluteLayout.LayoutFlags="All"
                                    AbsoluteLayout.LayoutBounds="0,0,1,1"
                                    HorizontalOptions="Fill"
                                    VerticalOptions="Fill" />

                <!-- Overlay -->
                <GraphicsView x:Name="Overlay"
                              AbsoluteLayout.LayoutFlags="All"
                              AbsoluteLayout.LayoutBounds="0,0,1,1"
                              HorizontalOptions="Fill"
                              VerticalOptions="Fill" />
            </AbsoluteLayout>
        </Grid>
    </Grid>
</ContentPage>
